{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Intro","text":"<p>MockerDB</p> <p>A python module that contains mock vector database like solution built around dictionary data type. It contains methods necessary to interact with this 'database', embed, search and persist.</p>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install mocker-db\n</code></pre>"},{"location":"cli/","title":"Cli","text":"<pre><code>mockerdb --help\n</code></pre> <pre><code>Usage: mockerdb [OPTIONS] COMMAND [ARGS]...\n\n  Mocker-db CLI tool\n\nOptions:\n  --help  Show this message and exit.\n\nCommands:\n  runserver  Run the FastAPI server for MockerDB.\n</code></pre> <p>Mocker-db exists as API that can be pulled from <code>dockerhub</code> as docker image. This pulls the code that functions within that docker image into some cached directory and runs uvicorn fastapi app from there, also saving mocker state there is persist path is not provided.</p> <pre><code>mockerdb runserver  --help\n</code></pre> <pre><code>Usage: mockerdb runserver [OPTIONS]\n\n  Run the FastAPI server for MockerDB.\n\nOptions:\n  --persist-path TEXT  Path where cache data will be saved. Path will be\n                       cached.\n  --repo-url TEXT      The URL of the GitHub repository to clone.\n  --host TEXT          The host to bind to.\n  --port INTEGER       The port to bind to.\n  --reload             Enable auto-reload.\n  --dump-cache         Overwrites existing cache.\n  --help               Show this message and exit.\n</code></pre>"},{"location":"flow/","title":"Flow","text":""},{"location":"release-notes/","title":"Release notes","text":""},{"location":"release-notes/#020","title":"0.2.0","text":"<pre><code>- precise keywords match with cutoff 1 and fuzzy match with &lt; 1 through filters\n\n- keywords search with difflib\n</code></pre>"},{"location":"release-notes/#013","title":"0.1.3","text":"<pre><code>- option to add embedding and distance to output list\n\n- option to remove output key while outputting the rest of keys\n</code></pre>"},{"location":"release-notes/#012","title":"0.1.2","text":"<pre><code>- initital cli interface that allows to clone code from api version of mocker and run it\n</code></pre>"},{"location":"release-notes/#011","title":"0.1.1","text":"<pre><code>- initial MockerConnect for using MockerDB API\n</code></pre>"},{"location":"release-notes/#0012","title":"0.0.12","text":"<pre><code>-  bugfix for similarity search through partly embedded data\n</code></pre>"},{"location":"release-notes/#0011","title":"0.0.11","text":"<pre><code>- more advanced filtering\n</code></pre>"},{"location":"release-notes/#0010","title":"0.0.10","text":"<pre><code>- fix for search without embeddings\n</code></pre>"},{"location":"release-notes/#006","title":"0.0.6","text":"<pre><code>- fix for embedding storage\n</code></pre>"},{"location":"release-notes/#005","title":"0.0.5","text":"<pre><code>- initial implementation of separate caching store for embeddings\n</code></pre>"},{"location":"release-notes/#004","title":"0.0.4","text":"<pre><code>- updating hnswlib 0.7.0 -&gt; 0.8.0 to fix vulnerabilities issue\n\n- fixing a bug with resetting mocker inner state properly after search\n</code></pre>"},{"location":"release-notes/#003","title":"0.0.3","text":"<pre><code>- slightly improving logic of embedding with batches in parallel for sentence transformer embedder (default embedder)\n\n- updating desciption\n</code></pre>"},{"location":"release-notes/#002","title":"0.0.2","text":"<pre><code>- better error handling in situations when data was not found with applied filters\n</code></pre>"},{"location":"release-notes/#001","title":"0.0.1","text":"<pre><code>- initial version of MockerDB package that evolved from mock classes from redis into a standalone solution\n</code></pre>"},{"location":"usage-examples/","title":"Mocker DB","text":"<p>This class is a mock handler for simulating a vector database, designed primarily for testing and development scenarios. It offers functionalities such as text embedding, hierarchical navigable small world (HNSW) search, and basic data management within a simulated environment resembling a vector database.</p> <pre><code># import sys\n# sys.path.append('../')\nimport numpy as np\nfrom mocker_db import MockerDB, SentenceTransformerEmbedder, MockerSimilaritySearch\n</code></pre> <pre><code>/home/kyriosskia/miniconda3/envs/testenv/lib/python3.10/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n</code></pre>"},{"location":"usage-examples/#usage-examples","title":"Usage examples","text":"<p>The examples contain: 1. Basic data insertion and retrieval 2. Text embedding and searching 3. Advanced filtering and removal 4. Testing the HNSW search algorithm 5. Simulating database connection and persistence</p>"},{"location":"usage-examples/#1-basic-data-insertion-and-retrieval","title":"1. Basic Data Insertion and Retrieval","text":"<pre><code># Initialization\nhandler = MockerDB(\n    # optional\n    embedder_params = {'model_name_or_path' : 'paraphrase-multilingual-mpnet-base-v2',\n                        'processing_type' : 'batch',\n                        'tbatch_size' : 500},\n    embedder = SentenceTransformerEmbedder,\n    ## optional/ for similarity search\n    similarity_search_h = MockerSimilaritySearch,\n    return_keys_list = None,\n    search_results_n = 3,\n    similarity_search_type = 'linear',\n    similarity_params = {'space':'cosine'},\n    ## optional/ inputs with defaults\n    file_path = \"./mock_persist\",\n    persist = True,\n    embedder_error_tolerance = 0.0\n)\n# Initialize empty database\nhandler.establish_connection()\n\n# Insert Data\nvalues_list = [\n    {\"text\": \"Sample text 1\",\n     \"text2\": \"Sample text 1\"},\n    {\"text\": \"Sample text 2\",\n     \"text2\": \"Sample text 2\"}\n]\nhandler.insert_values(values_list, \"text\")\nprint(f\"Items in the database {len(handler.data)}\")\n\n</code></pre> <pre><code>Items in the database 4\n</code></pre>"},{"location":"usage-examples/#retrieve-data-basics","title":"Retrieve Data Basics","text":"<pre><code># Retrieve Data\nhandler.filter_keys(subkey=\"text\", subvalue=\"Sample text 1\")\nhandler.search_database_keys(query='text')\nresults = handler.get_dict_results(return_keys_list=[\"text\"])\ndistances = handler.results_dictances\nprint(results)\nprint(distances)\n</code></pre> <pre><code>[{'text': 'Sample text 1'}]\n[0.6744726]\n</code></pre>"},{"location":"usage-examples/#search-and-retrieve-data","title":"Search and retrieve data","text":"<ul> <li>get all keys</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\",\n    },\n    return_keys_list=None\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'text': 'Sample text 1...', 'text2': 'Sample text 1...'}]\n</code></pre> <ul> <li>get all keys with keywords search</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    # when keyword key is provided filter is used to pass keywords\n    filter_criteria = {\n        \"text\" : [\"1\"],\n    },\n    keyword_check_keys = ['text'],\n    # percentage of filter keyword allowed to be different\n    keyword_check_cutoff = 1,\n    return_keys_list=['text']\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'text': 'Sample text 1...'}]\n</code></pre> <ul> <li>get all key - text2</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\",\n    },\n    return_keys_list=[\"-text2\"])\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'text': 'Sample text 1...'}]\n</code></pre> <ul> <li>get all keys + distance</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\"\n    },\n    return_keys_list=[\"+&amp;distance\"]\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'text': 'Sample text 1...', 'text2': 'Sample text 1...', '&amp;distance': '0.6744726...'}]\n</code></pre> <ul> <li>get distance</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\"\n    },\n    return_keys_list=[\"&amp;distance\"]\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'&amp;distance': '0.6744726...'}]\n</code></pre> <ul> <li>get all keys + embeddings</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\"\n    },\n    return_keys_list=[\"+embedding\"]\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n</code></pre> <pre><code>[{'text': 'Sample text 1...', 'text2': 'Sample text 1...', 'embedding': '[-4.94665056e-02 -2.38676026e-...'}]\n</code></pre> <ul> <li>get embeddings</li> </ul> <pre><code>results = handler.search_database(\n    query = \"text\",\n    filter_criteria = {\n        \"text\" : \"Sample text 1\"\n    },\n    return_keys_list=[\"embedding\"]\n)\nprint([{k: str(v)[:30] + \"...\" for k, v in result.items()} for result in results])\n\n</code></pre> <pre><code>[{'embedding': '[-4.94665056e-02 -2.38676026e-...'}]\n</code></pre>"},{"location":"usage-examples/#2-text-embedding-and-searching","title":"2. Text Embedding and Searching","text":"<pre><code>ste = SentenceTransformerEmbedder(# optional / adaptor parameters\n                                  processing_type = '',\n                                  tbatch_size = 500,\n                                  max_workers = 2,\n                                  # sentence transformer parameters\n                                  model_name_or_path = 'paraphrase-multilingual-mpnet-base-v2',)\n</code></pre> <pre><code># Single Text Embedding\nquery = \"Sample query\"\nembedded_query = ste.embed(query,\n                           # optional\n                           processing_type='')\nprint(embedded_query[0:50])\n</code></pre> <pre><code>[-0.04973587  0.09520266 -0.01219509  0.09253872 -0.02301828 -0.0272102\n  0.05683957  0.09710974  0.10683873  0.05812286  0.13227554  0.01142828\n -0.06957257  0.06980742 -0.05259363 -0.05755996  0.00816178 -0.00836837\n -0.00861246  0.01442065  0.01188813 -0.09503674  0.07125735 -0.04827795\n  0.01473159  0.01084172 -0.10482483  0.0701253  -0.0472064   0.10030049\n  0.04455939  0.0213189   0.00667923 -0.0525919   0.06822997 -0.09520472\n -0.00581364 -0.02451883 -0.00384985  0.02750736  0.06960268  0.24013738\n -0.01220023  0.05890927 -0.08468661  0.11379698 -0.03594772 -0.05652961\n -0.01621804  0.09546741]\n</code></pre> <pre><code># Batch Text Embedding\nqueries = [\"Sample query\", \"Sample query 2\"]\nembedded_query = ste.embed(queries,\n                           # optional\n                           processing_type='batch')\nprint(embedded_query[0][0:50])\nprint(\"---\")\nprint(embedded_query[1][0:50])\n</code></pre> <pre><code>[-0.04973588  0.09520268 -0.01219508  0.09253875 -0.02301828 -0.02721018\n  0.05683955  0.09710979  0.10683873  0.05812287  0.13227554  0.01142833\n -0.06957259  0.06980736 -0.05259363 -0.05755996  0.0081618  -0.00836839\n -0.00861242  0.01442068  0.01188811 -0.09503674  0.07125735 -0.04827797\n  0.01473157  0.01084175 -0.10482486  0.07012529 -0.04720639  0.10030051\n  0.04455936  0.02131891  0.00667919 -0.05259192  0.06822997 -0.09520471\n -0.00581361 -0.02451885 -0.00384985  0.02750732  0.06960279  0.24013741\n -0.0122002   0.05890926 -0.08468664  0.11379691 -0.03594773 -0.05652963\n -0.01621806  0.09546743]\n---\n[-0.05087035  0.12317687 -0.0139253   0.10524721 -0.07614311 -0.02349636\n  0.05829769  0.15128353  0.181198    0.03745941  0.12174654  0.00639845\n -0.04045051  0.12758298 -0.06155458 -0.0673613   0.04713941 -0.04134275\n -0.12165944  0.04409872  0.01834138 -0.04796622  0.04922184 -0.00641214\n  0.01420629 -0.03602948 -0.01026758  0.09232265 -0.04927171  0.0398545\n  0.03566905  0.08338926  0.04922605 -0.09951876  0.05138123 -0.13344647\n  0.01626777 -0.01189728  0.00599212  0.05663404  0.04282088  0.26432776\n -0.01122816  0.07177623 -0.11822147  0.08731955 -0.04965367  0.03697514\n  0.08965278  0.03107026]\n</code></pre> <pre><code># Search Database\nsearch_results = handler.search_database(query, return_keys_list=[\"text\"])\n\n# Display Results\nprint(search_results)\n\n</code></pre> <pre><code>[{'text': 'Sample text 1'}, {'text': 'Sample text 2'}, {'text': 'Sample text 2'}]\n</code></pre>"},{"location":"usage-examples/#3-advanced-filtering-and-removal","title":"3. Advanced Filtering and Removal","text":"<pre><code># Advanced Filtering\nfilter_criteria = {\"text\": \"Sample text 1\"}\nhandler.filter_database(filter_criteria)\nfiltered_data = handler.filtered_data\nprint(f\"Filtered data {len(filtered_data)}\")\n\n# Data Removal\nhandler.remove_from_database(filter_criteria)\nprint(f\"Items left in the database {len(handler.data)}\")\n\n</code></pre> <pre><code>Filtered data 1\nItems left in the database 3\n</code></pre>"},{"location":"usage-examples/#4-testing-the-hnsw-search-algorithm","title":"4. Testing the HNSW Search Algorithm","text":"<pre><code>mss = MockerSimilaritySearch(\n    # optional\n    search_results_n = 3,\n    similarity_params = {'space':'cosine'},\n    similarity_search_type ='linear'\n)\n</code></pre> <pre><code># Create embeddings\nembeddings = [ste.embed(\"example1\"), ste.embed(\"example2\")]\n\n\n# Assuming embeddings are pre-calculated and stored in 'embeddings'\ndata_with_embeddings = {\"record1\": {\"embedding\": embeddings[0]}, \"record2\": {\"embedding\": embeddings[1]}}\nhandler.data = data_with_embeddings\n\n# HNSW Search\nquery_embedding = embeddings[0]  # Example query embedding\nlabels, distances = mss.hnsw_search(query_embedding, np.array(embeddings), k=1)\nprint(labels, distances)\n\n</code></pre> <pre><code>[0] [1.1920929e-07]\n</code></pre>"},{"location":"usage-examples/#5-simulating-database-connection-and-persistence","title":"5. Simulating Database Connection and Persistence","text":"<pre><code># Establish Connection\nhandler.establish_connection()\n\n# Change and Persist Data\nhandler.insert_values([{\"text\": \"New sample text\"}], \"text\")\nhandler.save_data()\n\n# Reload Data\nhandler.establish_connection()\nprint(f\"Items in the database {len(handler.data)}\")\n\n</code></pre> <pre><code>Items in the database 3\n</code></pre>"}]}